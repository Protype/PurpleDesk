<?php

namespace App\Icon\Types;

use App\Icon\Color;
use App\Icon\IconTypeInterface;

class EmojiIcon implements IconTypeInterface
{
    /**
     * 常用的安全 emoji 列表（已過濾相容性問題的）
     */
    private array $safeEmojis = [
        '😀', '😃', '😄', '😁', '😊', '😇', '🙂', '😉', '😌', '😍',
        '🥰', '😘', '😗', '😙', '😚', '😋', '😛', '😜', '🤪', '😝',
        '🤗', '🤭', '🤫', '🤔', '😐', '😑', '😶', '😏', '😒', '🙄',
        '😬', '🤥', '😌', '😔', '😪', '😴', '😷', '🤒', '🤕', '🤢',
        '🥳', '😎', '🤓', '🧐', '😕', '😟', '🙁', '😮', '😯', '😲',
        '😳', '🥺', '😦', '😧', '😨', '😰', '😥', '😢', '😭', '😱',
        '😖', '😣', '😞', '😓', '😩', '😫', '🥱', '😤', '😡', '😠',
        '🤬', '😈', '👿', '💀', '💩', '🤡', '👹', '👺', '👻', '👽',
        '🤖', '😺', '😸', '😹', '😻', '😼', '😽', '🙀', '😿', '😾',
        '🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯',
        '🦁', '🐮', '🐷', '🐸', '🐵', '🙈', '🙉', '🙊', '🐒', '🐔',
        '🐧', '🐦', '🐤', '🐣', '🐥', '🦆', '🦅', '🦉', '🦇', '🐺',
        '🐗', '🐴', '🦄', '🐝', '🐛', '🦋', '🐌', '🐚', '🐞', '🐜',
        '🦗', '🕷', '🦂', '🐢', '🐍', '🦎', '🦖', '🦕', '🐙', '🦑',
        '🦐', '🦀', '🐡', '🐠', '🐟', '🐬', '🐳', '🐋', '🦈', '🐊',
        '🐅', '🐆', '🦓', '🦍', '🐘', '🦏', '🦛', '🐪', '🐫', '🦒',
        '🍏', '🍎', '🍐', '🍊', '🍋', '🍌', '🍉', '🍇', '🍓', '🍈',
        '🍒', '🍑', '🥭', '🍍', '🥥', '🥝', '🍅', '🍆', '🥑', '🥦',
        '🥬', '🥒', '🌶', '🌽', '🥕', '🥔', '🍠', '🥐', '🍞', '🥖',
        '🥨', '🥯', '🧀', '🥚', '🍳', '🥞', '🥓', '🥩', '🍗', '🍖',
        '🌭', '🍔', '🍟', '🍕', '🥪', '🥙', '🌮', '🌯', '🥗', '🥘',
        '🥫', '🍝', '🍜', '🍲', '🍛', '🍣', '🍱', '🍤', '🍙', '🍚',
        '🍘', '🍥', '🥮', '🥟', '🍢', '🍡', '🍧', '🍨', '🍦', '🥧',
        '🍰', '🎂', '🍮', '🍭', '🍬', '🍫', '🍿', '🍩', '🍪', '🌰',
        '⚽', '🏀', '🏈', '⚾', '🥎', '🏐', '🏉', '🎾', '🥏', '🎱',
        '🏓', '🏸', '🏒', '🏑', '🥍', '🏏', '🥅', '⛳', '🏹', '🎣',
        '🥊', '🥋', '🎽', '⛸', '🥌', '🛷', '🎿', '⛷', '🏂', '🏋',
        '🚗', '🚕', '🚙', '🚌', '🚎', '🏎', '🚓', '🚑', '🚒', '🚐',
        '🚚', '🚛', '🚜', '🛴', '🚲', '🛵', '🏍', '🚁', '🛩', '✈',
        '🚀', '🛸', '🚂', '🚆', '🚝', '🚄', '🚅', '🚈', '🚇', '🚊',
        '🏠', '🏡', '🏘', '🏚', '🏗', '🏭', '🏢', '🏬', '🏣', '🏤',
        '🏥', '🏦', '🏨', '🏪', '🏫', '🏩', '💒', '🏛', '⛪', '🕌',
        '🌍', '🌎', '🌏', '🌐', '🗺', '🗾', '🧭', '🏔', '⛰', '🌋',
        '🗻', '🏕', '🏖', '🏜', '🏝', '🏞', '🏟', '🏛', '🏗', '🏘',
        '💌', '💎', '💍', '💐', '💒', '💓', '💔', '💕', '💖', '💗',
        '💘', '💙', '💚', '💛', '💜', '🧡', '💝', '💞', '💟', '❣',
        '🎈', '🎉', '🎊', '🎋', '🎌', '🎍', '🎎', '🎏', '🎐', '🎑',
        '🎀', '🎁', '🎗', '🎟', '🎫', '🎖', '🏆', '🏅', '🥇', '🥈',
        '⭐', '🌟', '✨', '🌠', '🌌', '🌃', '🌄', '🌅', '🌆', '🌇',
        '🌈', '🌉', '🌊', '🌋', '🌌', '🌍', '🌎', '🌏', '🌐', '🌑',
        '📱', '💻', '⌨', '🖥', '🖨', '🖱', '🖲', '🕹', '🗜', '💾',
        '💿', '📀', '📼', '📷', '📸', '📹', '🎥', '📽', '🎞', '📞',
        '☎', '📟', '📠', '📺', '📻', '🎙', '🎚', '🎛', '⏱', '⏲',
        '⏰', '🕰', '⌛', '⏳', '📡', '🔋', '🔌', '💡', '🔦', '🕯',
        '✅', '❌', '❓', '❔', '❕', '❗', '⭕', '🔴', '🔵', '⚫',
        '⚪', '🟢', '🟡', '🟠', '🟣', '🟤', '🔶', '🔷', '🔸', '🔹',
    ];
    
    public function getType(): string
    {
        return 'emoji';
    }
    
    public function getRequiredFields(): array
    {
        return ['type', 'emoji'];
    }
    
    public function getOptionalFields(): array
    {
        return ['backgroundColor'];
    }
    
    public function validate(array $data): bool
    {
        // 檢查類型
        if (!isset($data['type']) || $data['type'] !== 'emoji') {
            return false;
        }
        
        // 檢查必要欄位
        if (!isset($data['emoji']) || empty($data['emoji'])) {
            return false;
        }
        
        // 如果有背景色，檢查是否有效
        if (isset($data['backgroundColor'])) {
            if (!Color::isAllowedBackgroundColor($data['backgroundColor'])) {
                return false;
            }
        }
        
        return true;
    }
    
    public function generateRandom(): array
    {
        $colorPair = Color::randomLightColorWithForeground();
        
        return [
            'type' => 'emoji',
            'emoji' => $this->safeEmojis[array_rand($this->safeEmojis)],
            'backgroundColor' => $colorPair['background'],
        ];
    }
    
    /**
     * 取得隨機 emoji（不含背景色）
     */
    public function getRandomEmoji(): string
    {
        return $this->safeEmojis[array_rand($this->safeEmojis)];
    }
    
    /**
     * 檢查 emoji 是否在安全列表中
     */
    public function isSafeEmoji(string $emoji): bool
    {
        return in_array($emoji, $this->safeEmojis, true);
    }
}