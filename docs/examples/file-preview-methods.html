<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File ç‰©ä»¶é è¦½æ–¹å¼æ¯”è¼ƒ</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .method { border: 1px solid #ddd; margin: 20px 0; padding: 20px; border-radius: 8px; }
        .preview-area { display: flex; gap: 20px; align-items: flex-start; margin-top: 15px; }
        .preview-box { border: 2px dashed #ccc; padding: 20px; min-height: 200px; flex: 1; text-align: center; }
        .preview-image { max-width: 100%; max-height: 200px; }
        .info { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; font-size: 14px; }
        .performance { color: #666; font-size: 12px; margin-top: 10px; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ğŸ” File ç‰©ä»¶é è¦½æ–¹å¼å¯¦ä½œæ¯”è¼ƒ</h1>
    
    <div>
        <input type="file" id="fileInput" accept="image/*">
        <button onclick="clearAll()">æ¸…é™¤æ‰€æœ‰é è¦½</button>
    </div>

    <!-- æ–¹å¼ 1: ç›´æ¥ä½¿ç”¨ File ç‰©ä»¶ (å¤±æ•—ç¤ºç¯„) -->
    <div class="method">
        <h3>âŒ æ–¹å¼ 1: ç›´æ¥ä½¿ç”¨ File ç‰©ä»¶ (ç„¡æ³•é è¦½)</h3>
        <div class="info">
            ç›´æ¥å°‡ File ç‰©ä»¶è¨­å®šç‚º img.src æ˜¯<strong>ç„¡æ³•é¡¯ç¤º</strong>çš„ï¼Œå› ç‚ºç€è¦½å™¨ä¸çŸ¥é“å¦‚ä½•æ¸²æŸ“ File ç‰©ä»¶ã€‚
        </div>
        <button onclick="previewMethod1()">å˜—è©¦ç›´æ¥é è¦½</button>
        <div class="preview-area">
            <div class="preview-box">
                <div id="method1-info">é¸æ“‡åœ–ç‰‡å¾Œé»æ“ŠæŒ‰éˆ•</div>
                <img id="method1-img" class="preview-image" style="display: none;">
                <div id="method1-performance" class="performance"></div>
            </div>
        </div>
    </div>

    <!-- æ–¹å¼ 2: File â†’ URL.createObjectURL -->
    <div class="method">
        <h3>âœ… æ–¹å¼ 2: File â†’ URL.createObjectURL (æ¨è–¦)</h3>
        <div class="info">
            å°‡ File ç‰©ä»¶è½‰æ›ç‚º Blob URLï¼Œé«˜æ•ˆèƒ½ä¸”é©åˆå¤§æª”æ¡ˆã€‚
        </div>
        <button onclick="previewMethod2()">URL.createObjectURL é è¦½</button>
        <div class="preview-area">
            <div class="preview-box">
                <div id="method2-info">é¸æ“‡åœ–ç‰‡å¾Œé»æ“ŠæŒ‰éˆ•</div>
                <img id="method2-img" class="preview-image" style="display: none;">
                <div id="method2-url" class="info" style="display: none;"></div>
                <div id="method2-performance" class="performance"></div>
            </div>
        </div>
    </div>

    <!-- æ–¹å¼ 3: File â†’ FileReader â†’ Base64 -->
    <div class="method">
        <h3>âœ… æ–¹å¼ 3: File â†’ FileReader â†’ Base64</h3>
        <div class="info">
            å°‡ File ç‰©ä»¶è®€å–ç‚º Base64 æ ¼å¼ï¼Œé©åˆå°æª”æ¡ˆæˆ–éœ€è¦å­˜å„²çš„æƒ…æ³ã€‚
        </div>
        <button onclick="previewMethod3()">FileReader Base64 é è¦½</button>
        <div class="preview-area">
            <div class="preview-box">
                <div id="method3-info">é¸æ“‡åœ–ç‰‡å¾Œé»æ“ŠæŒ‰éˆ•</div>
                <img id="method3-img" class="preview-image" style="display: none;">
                <div id="method3-base64" class="info" style="display: none;"></div>
                <div id="method3-performance" class="performance"></div>
            </div>
        </div>
    </div>

    <!-- æ–¹å¼ 4: File â†’ Canvas -->
    <div class="method">
        <h3>âœ… æ–¹å¼ 4: File â†’ Canvas (å¯è™•ç†)</h3>
        <div class="info">
            å…ˆè½‰ç‚º Blob URL è¼‰å…¥åœ–ç‰‡ï¼Œå†ç¹ªè£½åˆ° Canvasï¼Œé©åˆéœ€è¦åœ–ç‰‡è™•ç†çš„å ´æ™¯ã€‚
        </div>
        <button onclick="previewMethod4()">Canvas é è¦½</button>
        <div class="preview-area">
            <div class="preview-box">
                <div id="method4-info">é¸æ“‡åœ–ç‰‡å¾Œé»æ“ŠæŒ‰éˆ•</div>
                <canvas id="method4-canvas" class="preview-image" style="display: none;"></canvas>
                <div id="method4-performance" class="performance"></div>
            </div>
        </div>
    </div>

    <!-- æ–¹å¼ 5: æ··åˆæ–¹å¼ (å¯¦ç”¨) -->
    <div class="method">
        <h3>ğŸ¯ æ–¹å¼ 5: æ··åˆæ–¹å¼ (å¯¦éš›å°ˆæ¡ˆå»ºè­°)</h3>
        <div class="info">
            çµåˆå¤šç¨®æ–¹å¼ï¼šç«‹å³é è¦½ç”¨ createObjectURLï¼Œéœ€è¦ä¸Šå‚³æ™‚è½‰ Base64 æˆ–ç›´æ¥å‚³ Fileã€‚
        </div>
        <button onclick="previewMethod5()">æ··åˆæ–¹å¼é è¦½</button>
        <div class="preview-area">
            <div class="preview-box">
                <div id="method5-info">é¸æ“‡åœ–ç‰‡å¾Œé»æ“ŠæŒ‰éˆ•</div>
                <img id="method5-img" class="preview-image" style="display: none;">
                <div id="method5-details" class="info" style="display: none;"></div>
                <div id="method5-performance" class="performance"></div>
            </div>
        </div>
    </div>

    <script>
        let currentFile = null;
        let blobUrls = []; // è¿½è¹¤æ‰€æœ‰å»ºç«‹çš„ Blob URL

        document.getElementById('fileInput').addEventListener('change', (e) => {
            currentFile = e.target.files[0];
            if (currentFile) {
                document.querySelectorAll('[id$="-info"]').forEach(el => {
                    el.textContent = `å·²é¸æ“‡: ${currentFile.name} (${(currentFile.size / 1024 / 1024).toFixed(2)} MB)`;
                    el.className = 'success';
                });
            }
        });

        // æ–¹å¼ 1: ç›´æ¥ä½¿ç”¨ File ç‰©ä»¶ (å¤±æ•—ç¤ºç¯„)
        function previewMethod1() {
            if (!currentFile) {
                alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            const start = performance.now();
            const img = document.getElementById('method1-img');
            const info = document.getElementById('method1-info');
            
            try {
                // å˜—è©¦ç›´æ¥è¨­å®š File ç‰©ä»¶
                img.src = currentFile; // é€™ä¸æœƒå·¥ä½œ
                img.style.display = 'block';
                
                img.onload = () => {
                    const end = performance.now();
                    document.getElementById('method1-performance').textContent = 
                        `è™•ç†æ™‚é–“: ${(end - start).toFixed(2)}ms`;
                };

                img.onerror = () => {
                    const end = performance.now();
                    info.textContent = 'âŒ ç„¡æ³•é è¦½ï¼šFile ç‰©ä»¶ä¸èƒ½ç›´æ¥ä½œç‚ºåœ–ç‰‡ src';
                    info.className = 'error';
                    img.style.display = 'none';
                    document.getElementById('method1-performance').textContent = 
                        `å¤±æ•—æ™‚é–“: ${(end - start).toFixed(2)}ms`;
                };

            } catch (error) {
                info.textContent = `âŒ éŒ¯èª¤: ${error.message}`;
                info.className = 'error';
            }
        }

        // æ–¹å¼ 2: URL.createObjectURL
        function previewMethod2() {
            if (!currentFile) {
                alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            const start = performance.now();
            const img = document.getElementById('method2-img');
            const info = document.getElementById('method2-info');
            const urlDiv = document.getElementById('method2-url');
            
            try {
                const blobUrl = URL.createObjectURL(currentFile);
                blobUrls.push(blobUrl);
                
                img.src = blobUrl;
                img.style.display = 'block';
                
                urlDiv.textContent = `ç”Ÿæˆçš„ Blob URL: ${blobUrl}`;
                urlDiv.style.display = 'block';
                
                img.onload = () => {
                    const end = performance.now();
                    info.textContent = `âœ… æˆåŠŸè¼‰å…¥ ${currentFile.name}`;
                    info.className = 'success';
                    document.getElementById('method2-performance').textContent = 
                        `è™•ç†æ™‚é–“: ${(end - start).toFixed(2)}ms (æ¥µå¿«)`;
                };

            } catch (error) {
                info.textContent = `âŒ éŒ¯èª¤: ${error.message}`;
                info.className = 'error';
            }
        }

        // æ–¹å¼ 3: FileReader Base64
        function previewMethod3() {
            if (!currentFile) {
                alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            const start = performance.now();
            const img = document.getElementById('method3-img');
            const info = document.getElementById('method3-info');
            const base64Div = document.getElementById('method3-base64');
            
            const reader = new FileReader();
            
            reader.onload = (e) => {
                const end = performance.now();
                const base64 = e.target.result;
                
                img.src = base64;
                img.style.display = 'block';
                
                info.textContent = `âœ… æˆåŠŸè½‰æ› ${currentFile.name}`;
                info.className = 'success';
                
                base64Div.textContent = `Base64 é•·åº¦: ${base64.length} å­—ç¬¦ (å‰50å­—ç¬¦: ${base64.substring(0, 50)}...)`;
                base64Div.style.display = 'block';
                
                document.getElementById('method3-performance').textContent = 
                    `è™•ç†æ™‚é–“: ${(end - start).toFixed(2)}ms (è¼ƒæ…¢ï¼Œéœ€ç·¨ç¢¼)`;
            };

            reader.onerror = () => {
                const end = performance.now();
                info.textContent = 'âŒ FileReader è®€å–å¤±æ•—';
                info.className = 'error';
                document.getElementById('method3-performance').textContent = 
                    `å¤±æ•—æ™‚é–“: ${(end - start).toFixed(2)}ms`;
            };

            reader.readAsDataURL(currentFile);
        }

        // æ–¹å¼ 4: Canvas
        function previewMethod4() {
            if (!currentFile) {
                alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            const start = performance.now();
            const canvas = document.getElementById('method4-canvas');
            const ctx = canvas.getContext('2d');
            const info = document.getElementById('method4-info');
            
            // å…ˆç”¨ createObjectURL è¼‰å…¥åœ–ç‰‡
            const blobUrl = URL.createObjectURL(currentFile);
            blobUrls.push(blobUrl);
            
            const img = new Image();
            
            img.onload = () => {
                const end = performance.now();
                
                // è¨­å®š canvas å°ºå¯¸
                canvas.width = Math.min(img.width, 400);
                canvas.height = Math.min(img.height, 300);
                
                // ç¹ªè£½åœ–ç‰‡åˆ° canvas
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                canvas.style.display = 'block';
                info.textContent = `âœ… Canvas æ¸²æŸ“å®Œæˆ ${currentFile.name}`;
                info.className = 'success';
                
                document.getElementById('method4-performance').textContent = 
                    `è™•ç†æ™‚é–“: ${(end - start).toFixed(2)}ms (åŒ…å«æ¸²æŸ“)`;
                
                URL.revokeObjectURL(blobUrl);
            };

            img.onerror = () => {
                const end = performance.now();
                info.textContent = 'âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•—';
                info.className = 'error';
                document.getElementById('method4-performance').textContent = 
                    `å¤±æ•—æ™‚é–“: ${(end - start).toFixed(2)}ms`;
            };

            img.src = blobUrl;
        }

        // æ–¹å¼ 5: æ··åˆæ–¹å¼
        function previewMethod5() {
            if (!currentFile) {
                alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            const start = performance.now();
            const img = document.getElementById('method5-img');
            const info = document.getElementById('method5-info');
            const details = document.getElementById('method5-details');
            
            // éšæ®µ 1: ç«‹å³é è¦½ (createObjectURL)
            const blobUrl = URL.createObjectURL(currentFile);
            blobUrls.push(blobUrl);
            img.src = blobUrl;
            img.style.display = 'block';
            
            const preview1Time = performance.now();
            
            info.textContent = `âœ… ç«‹å³é è¦½å®Œæˆ ${currentFile.name}`;
            info.className = 'success';
            
            // éšæ®µ 2: èƒŒæ™¯è™•ç† (Base64 for upload)
            const reader = new FileReader();
            reader.onload = (e) => {
                const end = performance.now();
                const base64 = e.target.result;
                
                details.innerHTML = `
                    <strong>æ··åˆè™•ç†çµæœ:</strong><br>
                    â€¢ ç«‹å³é è¦½: ${(preview1Time - start).toFixed(2)}ms (createObjectURL)<br>
                    â€¢ Base64 æº–å‚™: ${(end - preview1Time).toFixed(2)}ms (èƒŒæ™¯è™•ç†)<br>
                    â€¢ ç¸½è™•ç†æ™‚é–“: ${(end - start).toFixed(2)}ms<br>
                    â€¢ File ç‰©ä»¶: ${currentFile.name} (${(currentFile.size / 1024).toFixed(1)} KB)<br>
                    â€¢ Base64 å¤§å°: ${(base64.length / 1024).toFixed(1)} KB<br>
                    â€¢ å¯ç”¨æ–¼: ç«‹å³é è¦½ + API ä¸Šå‚³
                `;
                details.style.display = 'block';
            };
            
            reader.readAsDataURL(currentFile);
            
            document.getElementById('method5-performance').textContent = 
                `ç«‹å³é è¦½: ${(preview1Time - start).toFixed(2)}msï¼ŒèƒŒæ™¯è™•ç†ä¸­...`;
        }

        // æ¸…é™¤æ‰€æœ‰é è¦½
        function clearAll() {
            // æ¸…é™¤ Blob URLs
            blobUrls.forEach(url => URL.revokeObjectURL(url));
            blobUrls = [];
            
            // æ¸…é™¤æ‰€æœ‰åœ–ç‰‡
            document.querySelectorAll('img').forEach(img => {
                img.src = '';
                img.style.display = 'none';
            });
            
            // æ¸…é™¤ canvas
            const canvas = document.getElementById('method4-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            canvas.style.display = 'none';
            
            // é‡ç½®æ‰€æœ‰è¨Šæ¯
            document.querySelectorAll('[id$="-info"]').forEach(el => {
                el.textContent = 'å·²æ¸…é™¤æ‰€æœ‰é è¦½';
                el.className = '';
            });
            
            document.querySelectorAll('[id$="-performance"]').forEach(el => {
                el.textContent = '';
            });
            
            document.querySelectorAll('[id$="-url"], [id$="-base64"], [id$="-details"]').forEach(el => {
                el.style.display = 'none';
            });
            
            currentFile = null;
            document.getElementById('fileInput').value = '';
        }

        // é é¢å¸è¼‰æ™‚æ¸…ç†è³‡æº
        window.addEventListener('beforeunload', () => {
            blobUrls.forEach(url => URL.revokeObjectURL(url));
        });
    </script>
</body>
</html>